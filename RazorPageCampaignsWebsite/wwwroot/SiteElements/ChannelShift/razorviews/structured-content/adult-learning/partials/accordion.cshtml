@{

// Name: Channel Shift - Structured Content (Content types)
// Developer: Asif Nissar
// Name: Accordion Content - used in Adult Learning
// License: Blackpool council
// Date: 11/11/2021
}


@using System;
@using Blackpool.Zengenti.CMS.Helpers;
@using Blackpool.Zengenti.CMS.Constants;
@using Blackpool.Zengenti.CMS.Models.GenericTypes;
@using Blackpool.Zengenti.CMS.Models.Venues;
@using Blackpool.Zengenti.CMS.Models.Components;
@using Blackpool.Zengenti.CMS.Models.GenericTypes;
@using Blackpool.Zengenti.CMS.Models.Components;
@using Blackpool.Zengenti.CMS.Helpers.Components;
@using Zengenti.Contensis.Delivery;

@{ 

    BlackpoolAdultLearningDTO DTO = Page.Model;
    List<AccordionContent>
    accordion = new List<AccordionContent>();


    var config              = DTO.Config;
    string urlPath          = DTO.Config.SeoUrlList.UrlPath;
    Boolean accordionFound  = false;
    int counter             = 0;

    if (DTO.Flow != null)
    {
        foreach (var item in DTO.Flow.GetContent)
        {
            List<SerialisedItem>
                SerailisedList = item.Items.FindAll(x => x.ClassType == typeof(AccordionContent));
            if (SerailisedList != null && counter >= DTO.CurrentFlowPosition)
            {
                foreach (SerialisedItem si in SerailisedList)
                {

                    AccordionContent temp = SerializeHelper.Deseralize(si) as AccordionContent;
                    temp.Body             = StringUtility.UpdateLinks(temp.Body,
                                            StringUtility.FindHrefs(temp.Body),
                                            SiteViewKeys.ADULT_LEARNING_PATH, urlPath);
                    accordion.Add(temp);
                    accordionFound = true;
                }
            }

            counter++;
            if (accordionFound)
            {
                DTO.CurrentFlowPosition = counter;
                break;
            }
        }
    }

    int accCount = 1;

            }

@if (accordion.Count > 0)
{
    <div class="accordion clearfix">
        <ul id="accordion-ul" class="outer-ul">
            @foreach (var item in accordion)
            {

                <li class="head">
                    <a id="@String.Format("link-head-{0}", @accCount)" class="link-head open" href="#">
                        <h2 class="clearfix"><span class="arrow-span pull-left"><i title="Open or close" class="icon-arrow-down"></i></span><span class="title-span pull-left">@item.Title</span></h2></a>
                    <div class="accordion-togglable" style=" display: none;">
                        <div class="row zero-margin-all accordion-outer-container">
                            <div class="col-md-12 col-sm-12 col-xs-12 zero-pad-all accordion-container"style=" ">
                                @Html.Raw(item.Body)
                            </div>
                        </div>
                    </div>
                </li>
                accCount++;
            }
        </ul>
    </div>

}

