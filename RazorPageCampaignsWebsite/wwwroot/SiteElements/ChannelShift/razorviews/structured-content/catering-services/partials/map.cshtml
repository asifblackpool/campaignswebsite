@{

    // Name: Channel Shift - Structured Content (Content types)
    // Developer: Asif Nissar
    // Name: Load Google Map - used in cateing pages
    // License: Blackpool council
    // Date: 11/06/2018
}


@using System;
@using System.Collections;
@using Contensis.Framework.Web
@using Newtonsoft.Json
@using Zengenti.Contensis.Delivery;
@using Zengenti.Data;

@using Blackpool.Zengenti.CMS.Helpers;
@using Blackpool.Zengenti.CMS.Models.Catering;
@using Blackpool.Zengenti.CMS.Models.Venues;
@using Blackpool.Zengenti.CMS.Models.GenericTypes;


@{

    string apiKey = System.Web.Configuration.WebConfigurationManager.AppSettings["GoogleApiKey"];
    apiKey = "AIzaSyBfWeG2dabN1g5VQoBa9aF38WS1Jdg5vMc";
    CateringDTO DTO = Page.Model;
    SerialisedItem serialisedItem = null;
    Venue venue = null;
    if (DTO.Flow != null){
        foreach (var item in DTO.Flow.GetContent)
        {
            var list = item.Items.FindAll(x => x.ClassType == typeof(Venue));
            if (list != null && list.Count > 0)
            {
                serialisedItem = list[0];
                venue = SerializeHelper.Deseralize(serialisedItem) as Venue;
                break;
            }
        }
    }
}
 
    @if (venue != null) { 
    <strong style="font-weight:normal">@Html.Raw((venue != null) ? venue.FormattedAddress : string.Empty)</strong><br/>
    <strong style="font-weight:normal">@Html.Raw((string.IsNullOrEmpty(venue.TelephoneNumber) ? string.Empty : venue.TelephoneNumber + "<br/>"))</strong>
    <strong style ="font-weight:normal">@Html.Raw(string.IsNullOrEmpty(venue.Email) ? string.Empty : String.Format("<a href=\"mailto:{0}\">{0}</a><br/>", venue.Email))</strong>
    <br/>
    <div id="map" style="width:100%;height:650px;background:yellow"></div>

    <script type="text/javascript">
        $(document).ready(function () {
            googlemapservices.map('@venue.LocationMap.Lat', '@venue.LocationMap.Lon', "map", 17);
        });
    </script>
    <script src="@String.Format("https://maps.googleapis.com/maps/api/js?key={0}",apiKey)"></script>
    }

