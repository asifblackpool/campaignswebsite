@using Contensis.Framework.Web;
@using System.Collections.ObjectModel;
@using System.Collections;

@{

    // Name: Channel Shift - New Top tasks
    // Developer: Asif Nissar
    // License: Blackpool council
    // Require
}

@functions {

    string errorMessage = string.Empty;

    //Icon object to hold Icon Information
    public class HomepageIcon
    {
        public string Name { get; set; }
        public string Url { get; set; }
        public string Text {get; set; }
    }

    //Icons object to hold a list of Icons
    public class HomepageIcons
    {
        private List<HomepageIcon> _iconList = null;

        public HomepageIcons() { _iconList = new List<HomepageIcon>(); }

        public void AddIcons(HomepageIcon icon)
        {
            if (icon == null)
                return;

            _iconList.Add(icon);
        }

        public List<HomepageIcon> GetIcons
        {
            get { return _iconList; }
        }
    }
}

@{
    //-----------------------------------------------------------------------
    //1. Top Tasks Content (Code)
    //-----------------------------------------------------------------------
    
    string rowContainerTemplate     = "<div class='row top-pad-30'>{0}</div>";
    string itemContainerTemplate    = "<div class='col-xs-12 col-sm-3 col-md-4 zero-pad-left zero-pad-right clearfix'>{0}</div>";
    string itemTemplate             = "<div class='top-task-item'><h2 class='top-task-heading'><a class='task-link accessibility-tab' href='{0}'>{1}<i class='arrow right'></i></a></h2><p>{2}</p></div>";
    string htmlBuilder              = string.Empty;


    //Declare icons object to hold your information and populate the icons
    var icons = new HomepageIcons();
     List<KeyValuePair<String, String>> links = new List<KeyValuePair<String, String>>();
     
    try{
        var items = Properties.Icons;

        if (items != null) {
            foreach (var item in items)
            {
                icons.AddIcons(new HomepageIcon()
                {
                    Name = item.Title,
                    Text = item.IconText,
                    Url = (item.Url != null) ? item.Url.Path : "#"
                });
            }
        }
    }
    catch
    {
        errorMessage = "error has occured";
    }
}

@{
    //-----------------------------------------------------------------------
    //2. All Services Content (Code)
    //-----------------------------------------------------------------------
    int depthCount                           = 2;
    string temp                              = string.Empty;
    string templateServicesOuterContainer    = string.Empty;
    string templateServicesContainer         = string.Empty;
    string htmlServicesOutput                = string.Empty;
    string listContainer                     = string.Empty;


    try
    {
        ReadOnlyCollection<ContentNode> residents = Properties.residentsQuery;
        ReadOnlyCollection<ContentNode> business = Properties.businessQuery;
        ReadOnlyCollection<ContentNode> council = Properties.councilQuery;

        templateServicesContainer = templateServicesContainer + "<div class='col-xs-12 col-sm-4 col-md-4 zero-pad-left zero-pad-right clearfix'>";
        templateServicesContainer = templateServicesContainer + "<div class='top-task-item'>";
        templateServicesContainer = templateServicesContainer + "<h2 class='top-task-heading' style='text-decoration:none;'>{0}</h2>";
        templateServicesContainer = templateServicesContainer + "<ul class='all-services-ul' style='padding-left: 0px !important;'>{1}";
        templateServicesContainer = templateServicesContainer + "</ul></div></div>";

        listContainer = "<li><a href='{0}' class='all-services-link accessibility-tab'>{1}</a></li>";

        var orderedResidents = residents.Where(x => x.Depth == depthCount).OrderBy(x => x.Data.Title).ToList();
        var orderedBusiness = business.Where(x => x.Depth == depthCount).OrderBy(x => x.Data.Title).ToList();
        var orderedCouncil = council.Where(x => x.Depth == depthCount).OrderBy(x => x.Data.Title).ToList();

        foreach (ContentNode n in orderedResidents)
        {
            temp = temp + string.Format(listContainer, n.Data.Path, n.Data.Title);
        }
        htmlServicesOutput = htmlServicesOutput + string.Format(templateServicesContainer, "Residents", temp);
        temp = string.Empty;

        foreach (ContentNode n in orderedBusiness)
        {
            temp = temp + string.Format(listContainer, n.Data.Path, n.Data.Title);
        }
        htmlServicesOutput = htmlServicesOutput + string.Format(templateServicesContainer, "Business", temp);
        temp = string.Empty;

        foreach (ContentNode n in orderedCouncil)
        {
            temp = temp + string.Format(listContainer, n.Data.Path, n.Data.Title);
        }
        htmlServicesOutput = htmlServicesOutput + string.Format(templateServicesContainer, "Your Council", temp);
        temp = string.Empty;
    }
    catch
    {

    }



}
<h1 style="display:none;">Blackpoool Council homepage</h1>
<!-- top task & services menu -->
<div id="top-tasks-menu" class="row">
    <div id="top-tasks-menu-container" class="col-md-12 zero-pad-left zero-pad-right">
        <ul class="top-tasks-ul">
            <li><span><a id="link-top-tasks" href="#"  class="top-task-link accessibility-tab" style="text-decoration:none;">Top tasks</a></span></li>
            <li><span><a id="link-all-serverics" href="#"  class="top-task-link accessibility-tab" style="text-decoration:none;">All services</a></span></li>
        </ul>
    </div>
</div>

<!-- 1. top task content -->  
<div id="top-tasks-outer-container" class="row">
    <div id="top-tasks-container"  class="col-md-12 zero-pad-left zero-pad-right">
       @foreach (var item in icons.GetIcons)
       {
          htmlBuilder = htmlBuilder + string.Format(itemContainerTemplate, (string.Format(itemTemplate, item.Url, item.Name, item.Text)));    
       }  
       @Html.Raw(string.Format(rowContainerTemplate, htmlBuilder))
    </div>
</div>

<!-- 2. all services content -->
<div id="all-services-outer-container" class="row">
    <div id="all-services-container" class="col-md-12 zero-pad-left zero-pad-right">
        <div class="row top-pad-30">
           @Html.Raw(htmlServicesOutput)
        </div>
    </div>
</div>


<script type="text/javascript">
    $(document).ready(function () {

        $("#all-services-outer-container").hide();

        var togglemenu = function (Id) {
            if (Id === 'link-top-tasks') {
                $("#top-tasks-outer-container").show();
                $("#all-services-outer-container").hide();

            } else {
                $("#all-services-outer-container").show();
                $("#top-tasks-outer-container").hide();
            }

            $("#top-tasks-menu-container ul li span").each(function () {
                var $li = $(this)
                $(this).css('border-bottom', '0px solid #FFDD00')
            });
            $("#" + Id).parent().css({ "border-bottom": "6px solid #FFDD00" });
        };


        $("a.top-task-link").on("click", function (e) {

            var linkId = $(this).attr('id');
            togglemenu(linkId);
            e.stopPropagation();
            e.preventDefault();
        });

        togglemenu('link-top-tasks');
    });
</script>@*<control name="channel shift Homepage Top tasks 2023" 
          showInMenu="true" 
          category="favourites" 
          viewingGroup="1">
 <properties>
    <category name="Top Tasks">
      <instruction label="Configurable Top Tasks">
          notes to go here 
      </instruction>
      <repeater name="Icons" min="3" max="15">  
        <text name="Title" />
        <node name="Url"  >
          	<parameters>
              <parameter name="ContentTypes" value="0"></parameter>
          </parameters>
        </node>
        <text name="IconText" label="Text" description="">
        <parameters>
          <parameter name="MultiLine" value="true"/>
        </parameters>
      </text>
      </repeater>
    </category>
	<nodeQuery name="residentsQuery">
			<where property="FullPath" operator="Contains" value="/residents/" />
				<and property="IsHomePage" operator="IsEqualTo" value="true" />
				<and property="IsWebPage" operator="IsEqualTo" value="true" />
		</nodeQuery>
		<nodeQuery name="businessQuery">
			<where property="FullPath" operator="Contains" value="/business/" />
				<and property="IsHomePage" operator="IsEqualTo" value="true" />
				<and property="IsWebPage" operator="IsEqualTo" value="true" />
		</nodeQuery>
		<nodeQuery name="councilQuery">
			<where property="FullPath" operator="Contains" value="/your-council/" />
				<and property="IsHomePage" operator="IsEqualTo" value="true" />
				<and property="IsWebPage" operator="IsEqualTo" value="true" />
		</nodeQuery>
  </properties>
</control>
    *@